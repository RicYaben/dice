syntax = "proto3";
package proto;
option go_package = "./proto";

message Empty {}

message Fields {
    bytes fields = 1;
}

message Event {
    uint32 id = 1;
    string type = 2;
}

message HandleRequest {
    uint32 add_server = 1;
    Event event = 2;
}

service Module {
    rpc Propagate(Empty) returns (Empty);
    rpc Properties(Empty) returns (Fields);
    rpc Handle(HandleRequest) returns (Empty);
}

message Host {
    uint32 id = 1;
    string address = 2;
    repeated Fingerprint fingerprints = 3;
}

message Fingerprint {
    uint32 id = 1;
    uint32 hostID = 2;
    // json data
    bytes data = 3;
    string service = 4;
    string protocol = 5;
    uint32 port = 6;
}

message Label {
    uint32 id = 1;
    uint32 hostID = 2;
    string label = 3;
}

message Scan {
    uint32 id = 1;
    repeated string targets = 2;
    string flags = 3;
    string module = 4;
}

message Source {
    uint32 id = 1;
    string format = 2;
    string path = 3;
    string scanner = 5;
}

message IDRequest {
    uint32 id = 1;
}

message QueryRequest {
    string query = 1;
}

message QueryResponse {
    repeated Host hosts = 1;
}

service Adapter {
    rpc GetHost(IDRequest) returns (Host);
    rpc GetSource(IDRequest) returns (Source);
    rpc GetScan(IDRequest) returns (Scan);

    rpc AddLabel(Label) returns (Empty);
    rpc AddFingerprint(Fingerprint) returns (Empty);
    rpc AddScan(Scan) returns (Empty);
    rpc AddSource(Source) returns (Empty);

    rpc Query(QueryRequest) returns (QueryResponse);
}